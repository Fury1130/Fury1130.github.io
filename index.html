<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supplier Database Management</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/axios/0.27.2/axios.min.js"></script>
    <style>
        * {margin:0;padding:0;box-sizing:border-box;font-family:Arial, sans-serif;}
        .container {max-width:1200px;margin:0 auto;padding:20px;}
        .section {border:1px solid #eee;border-radius:10px;padding:25px;margin-bottom:30px;box-shadow:0 2px 8px rgba(0,0,0,0.05);}
        .section h2 {font-size:20px;margin-bottom:20px;color:#333;border-bottom:1px solid #eee;padding-bottom:10px;}
        .form-group {display:flex;flex-wrap:wrap;margin-bottom:15px;gap:15px;}
        .form-item {flex:1;min-width:200px;}
        .form-item label {display:block;margin-bottom:5px;font-size:14px;color:#666;}
        .form-item input {width:100%;height:40px;padding:0 12px;border:1px solid #ddd;border-radius:6px;font-size:14px;}
        .btn {background:#07c160;color:#fff;border:none;border-radius:6px;height:40px;padding:0 20px;cursor:pointer;font-size:14px;margin-right:10px;}
        .btn-danger {background:#ff4d4f;}
        .btn-secondary {background:#909399;}
        .supplier-list {margin-top:20px;}
        .supplier-item {display:flex;align-items:center;padding:15px;border:1px solid #eee;border-radius:6px;margin-bottom:10px;}
        .supplier-item input {flex:1;margin:0 10px;height:36px;padding:0 10px;border:1px solid #ddd;border-radius:4px;}
        .pagination {display:flex;align-items:center;margin-top:20px;gap:10px;}
        .pagination button {padding:8px 15px;border:1px solid #ddd;border-radius:4px;cursor:pointer;}
        .pagination span {font-size:14px;color:#666;}
        .wework-select {margin-top:20px;}
        .wework-select select {width:100%;height:40px;padding:0 12px;border:1px solid #ddd;border-radius:6px;margin-bottom:15px;}
        .sync-btn {margin-bottom:20px;}
    </style>
</head>
<body>
    <div class="container" id="app">
        <!-- OA Selection Mode (Only show when wework=1) -->
        <div class="wework-select" v-if="isWeWork">
            <h2>Select Supplier</h2>
            <select v-model="selectedSupplier">
                <option value="">Please select a supplier</option>
                <option v-for="item in supplierList" :value="JSON.stringify(item)">{{ item.label }} ({{ item.BENEFICIARY }})</option>
            </select>
            <button class="btn" @click="submitToWeWork">Confirm</button>
        </div>

        <!-- Management Mode (Default) -->
        <div v-else>
            <!-- 1. Add Supplier Section -->
            <div class="section">
                <h2>1. Add New Supplier</h2>
                <div class="form-group">
                    <div class="form-item">
                        <label>Unique Code (value *)</label>
                        <input v-model="newSupplier.value" placeholder="e.g. B001">
                    </div>
                    <div class="form-item">
                        <label>Display Name (label *)</label>
                        <input v-model="newSupplier.label" placeholder="e.g. Supplier A">
                    </div>
                    <div class="form-item">
                        <label>NO</label>
                        <input v-model="newSupplier.NO" placeholder="e.g. 1">
                    </div>
                    <div class="form-item">
                        <label>BENEFICIARY</label>
                        <input v-model="newSupplier.BENEFICIARY" placeholder="e.g. A.Z FOR BUILDING LTD">
                    </div>
                </div>
                <div class="form-group">
                    <div class="form-item">
                        <label>SUBJECT</label>
                        <input v-model="newSupplier.SUBJECT" placeholder="e.g. Concrete Admixture">
                    </div>
                    <div class="form-item">
                        <label>Bank</label>
                        <input v-model="newSupplier.Bank" placeholder="e.g. ICBC">
                    </div>
                    <div class="form-item">
                        <label>Branch</label>
                        <input v-model="newSupplier.Branch" placeholder="e.g. Beijing Chaoyang Branch">
                    </div>
                    <div class="form-item">
                        <label>Account No</label>
                        <input v-model="newSupplier['Account No']" placeholder="e.g. 6222081234567890">
                    </div>
                </div>
                <button class="btn" @click="addSupplier">Add Supplier</button>
                <button class="btn btn-secondary" @click="resetAddForm">Reset Form</button>
            </div>

            <!-- 2. Manage Supplier Section (Pagination) -->
            <div class="section">
                <h2>2. Manage Supplier Database</h2>
                
                <!-- Tencent Docs Sync Button -->
                <button class="btn sync-btn" @click="syncWithTencentDocs">Sync with Tencent Docs</button>
                
                <!-- Pagination Control -->
                <div class="pagination">
                    <button @click="prevPage" :disabled="currentPage === 1">Previous Page</button>
                    <span>Page {{ currentPage }} / {{ totalPages }}</span>
                    <button @click="nextPage" :disabled="currentPage === totalPages">Next Page</button>
                    <span>Show {{ pageSize }} items per page</span>
                </div>

                <!-- Supplier List (Pagination) -->
                <div class="supplier-list">
                    <div class="supplier-item" v-for="(item, index) in paginatedList" :key="item.value">
                        <input v-model="item.value" disabled placeholder="Unique Code" style="width:80px;">
                        <input v-model="item.label" placeholder="Display Name" style="width:120px;">
                        <input v-model="item.NO" placeholder="NO" style="width:60px;">
                        <input v-model="item.BENEFICIARY" placeholder="BENEFICIARY" style="width:200px;">
                        <input v-model="item.SUBJECT" placeholder="SUBJECT" style="width:150px;">
                        <input v-model="item.Bank" placeholder="Bank" style="width:100px;">
                        <input v-model="item.Branch" placeholder="Branch" style="width:150px;">
                        <input v-model="item['Account No']" placeholder="Account No" style="width:180px;">
                        <button class="btn" @click="saveSingleSupplier(index)">Save</button>
                        <button class="btn btn-danger" @click="deleteSupplier(index)">Delete</button>
                    </div>
                </div>

                <!-- Save All Changes Button -->
                <button class="btn" @click="saveAllChanges" style="margin-top:20px;">Save All Changes</button>
            </div>
        </div>
    </div>

    <script>
        new Vue({
            el: '#app',
            data: {
                // Basic Config
                isWeWork: false,
                selectedSupplier: '',
                pageSize: 20, // 20 items per page
                currentPage: 1,
                
                // New Supplier Form
                newSupplier: {
                    value: '', label: '', NO: '', BENEFICIARY: '',
                    SUBJECT: '', Bank: '', Branch: '', 'Account No': ''
                },

                // Supplier Database (Initial Data)
                supplierList: [
                    {
                        value: 'B001', label: 'Supplier A', NO: '1',
                        BENEFICIARY: 'A.Z FOR BUILDING LTD', SUBJECT: 'Concrete Admixture',
                        Bank: 'ICBC', Branch: 'Beijing Chaoyang Branch', 'Account No': '6222081234567890'
                    },
                    {
                        value: 'B002', label: 'Supplier B', NO: '2',
                        BENEFICIARY: 'AA migun', SUBJECT: 'Explosion-proof pipe',
                        Bank: 'CCB', Branch: 'Shanghai Pudong Branch', 'Account No': '6227000987654321'
                    }
                ],

                // Tencent Docs Config (Replace with your own Tencent Docs API)
                tencentDocsUrl: 'https://docs.qq.com/datasource/your-tencent-docs-api' // 替换为你的腾讯文档API地址
            },
            computed: {
                // Pagination: Filter current page data
                paginatedList() {
                    const start = (this.currentPage - 1) * this.pageSize;
                    const end = start + this.pageSize;
                    return this.supplierList.slice(start, end);
                },
                // Total pages
                totalPages() {
                    return Math.ceil(this.supplierList.length / this.pageSize);
                }
            },
            mounted() {
                // 1. Check if from WeWork OA
                this.isWeWork = window.location.href.includes('wework=1');
                // 2. Load local storage data
                this.loadFromLocalStorage();
            },
            methods: {
                // ---------------------- Basic Data Operations ----------------------
                // Load data from local storage
                loadFromLocalStorage() {
                    const localData = localStorage.getItem('supplierDB');
                    if (localData) this.supplierList = JSON.parse(localData);
                },
                // Save data to local storage
                saveToLocalStorage() {
                    localStorage.setItem('supplierDB', JSON.stringify(this.supplierList));
                    alert('Data saved successfully!');
                },

                // ---------------------- Add Supplier Section ----------------------
                // Add new supplier
                addSupplier() {
                    if (!this.newSupplier.value || !this.newSupplier.label) {
                        alert('Unique Code (value) and Display Name (label) are required!');
                        return;
                    }
                    // Check duplicate unique code
                    const isDuplicate = this.supplierList.some(item => item.value === this.newSupplier.value);
                    if (isDuplicate) {
                        alert('Unique Code already exists! Please use a different code.');
                        return;
                    }
                    this.supplierList.push({...this.newSupplier});
                    this.saveToLocalStorage();
                    this.resetAddForm();
                    alert('Supplier added successfully!');
                },
                // Reset add form
                resetAddForm() {
                    this.newSupplier = {
                        value: '', label: '', NO: '', BENEFICIARY: '',
                        SUBJECT: '', Bank: '', Branch: '', 'Account No': ''
                    };
                },

                // ---------------------- Manage Supplier Section ----------------------
                // Previous page
                prevPage() {
                    if (this.currentPage > 1) this.currentPage--;
                },
                // Next page
                nextPage() {
                    if (this.currentPage < this.totalPages) this.currentPage++;
                },
                // Save single supplier changes
                saveSingleSupplier(index) {
                    this.saveToLocalStorage();
                    alert('Supplier updated successfully!');
                },
                // Delete supplier
                deleteSupplier(index) {
                    if (confirm('Are you sure to delete this supplier? This action cannot be undone!')) {
                        // Get real index in original list
                        const realIndex = (this.currentPage - 1) * this.pageSize + index;
                        this.supplierList.splice(realIndex, 1);
                        this.saveToLocalStorage();
                        // Refresh pagination if current page is empty
                        if (this.paginatedList.length === 0 && this.currentPage > 1) {
                            this.currentPage--;
                        }
                    }
                },
                // Save all changes
                saveAllChanges() {
                    this.saveToLocalStorage();
                    alert('All changes saved successfully!');
                },

                // ---------------------- Tencent Docs Sync ----------------------
                // Sync with Tencent Docs (Replace with real API logic)
                syncWithTencentDocs() {
                    // 1. Get data from Tencent Docs (Example)
                    axios.get(this.tencentDocsUrl)
                        .then(res => {
                            if (res.data.code === 0) {
                                this.supplierList = res.data.data;
                                this.saveToLocalStorage();
                                alert('Synced with Tencent Docs successfully!');
                            }
                        })
                        .catch(err => {
                            alert('Sync failed! Please check Tencent Docs API URL.');
                            console.error('Tencent Docs Sync Error:', err);
                        });
                    
                    // 2. Push local data to Tencent Docs (Add your own logic here)
                    // axios.post(this.tencentDocsUrl, this.supplierList)
                    //     .then(res => alert('Data pushed to Tencent Docs successfully!'));
                },

                // ---------------------- WeWork OA Integration ----------------------
                // Submit selected supplier to WeWork OA
                submitToWeWork() {
                    if (!this.selectedSupplier) {
                        alert('Please select a supplier first!');
                        return;
                    }
                    window.parent.postMessage({
                        type: 'setSelectValue',
                        value: this.selectedSupplier
                    }, '*');
                }
            }
        })
    </script>
</body>
</html>
